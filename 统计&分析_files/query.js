function replaceName(a){return a?a=a.replace(/[\'\"\(\)\<\>]/g,""):""}function saveQuery(a,b){var e,c=getQueryCond(),d="";"100"==a?d="&share=1":a&&(d="&s="+a),e="",queryName&&(e="&name="+encodeURIComponent(replaceName(queryName))),b&&(d+="&isreport=1"),"1"==window.satParam&&(d+="&sat=1"),PDF_launch("/wjx/activitystat/savereport.aspx?activity="+activityId+e+"&type=1"+d+"&qCond="+c[0]+"&econd="+c[1],420,100)}function toCheck(a){if(!a.value){var b=a.parentNode.ddlQuery;b||(b=a.parentNode.parentNode.getElementsByTagName("select")[0]),htCheckQs[b.value]="1",showCondition.call(b)}}function showMulCond(a,b,c,d){var e,f,g,h,i,j;if(htCheckQs[d]){for(e="",e+="<span class='wjxui-input-block wjxui-form-checkbox wjx__templet__beautifyInput'>&nbsp;&nbsp;",f=0;f<b.options.length-1;f++)g=b.options[f],h=g.value,i=g.text,j="ccdcv"+c+"_"+(f+1),e+="<input type='checkbox' value='"+h+"' id='"+j+"'/><label for='"+j+"' style='margin-right:12px;'>"+i+"</label>";e+="</span>",a.style.verticalAlign="top",a.style.lineHeight="22px",a.innerHTML=e}else a.appendChild(b).cloneNode(!0)}function showCondition(){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,a=this.value,b=this,c=this.spanCondition||document.createElement("span");if(c.innerHTML="",this.style.width="320px",parseInt(a)==a){if(d=this.selectedIndex,e=qsQuery[d],f=e.split("§"),g="",e){if(htCheckQs[a]){for(g+="<span class='wjxui-input-block wjxui-form-checkbox wjx__templet__beautifyInput'>&nbsp;&nbsp;",h=0;h<f.length;h++)i=h+1,j=f[h],k="ccc"+a+"_"+i,g+="<input type='checkbox' value='"+i+"' id='"+k+"'/><label for='"+k+"' style='margin-right:12px;'>"+j+"</label>";g+="</span>",c.style.display="top",c.style.lineHeight="22px"}else{for(g="<select id='sel"+d+"'  style='width:270px;' onchange='toCheck(this);'>",h=0;h<f.length;h++)i=h+1,j=f[h],g+="<option value='"+i+"'>"+j+"</option>";g+="<option value='-3'>(跳过)</option>",g+="<option value='-2'>(空)</option>",g+="<optgroup label='---------------------'>",g+="<option value=''>合并多个选项的数据</option>",g+="<optgroup>",g+="</select>",c.style.verticalAlign="",c.style.lineHeight=""}c.innerHTML=g}else l=this.options[this.selectedIndex],m=l.getAttribute("isdigit"),n="1"==l.getAttribute("isdate"),htQuestion[a]="1",m||n?(c.appendChild(document.getElementById("spanEntry").cloneNode(!0)),o=c.getElementsByTagName("select")[0],o.onchange=function(){var a=this.parentNode.getElementsByTagName("label")[0];a.style.display="3"==this.value?"":"none"},o.onchange(),htQuestion[a]="2"):c.appendChild(document.getElementById("spanQuestion").cloneNode(!0));c.ddlQuery=b}else switch(a){case"省份":ddlProvince.dataLoaded?showMulCond(c,ddlProvince,1,a):loadJoinData(c,ddlProvince,1);break;case"来源":ddlSource.dataLoaded?showMulCond(c,ddlSource,3,a):loadJoinData(c,ddlSource,3);break;case"城市":ddlCity.dataLoaded?c.appendChild(ddlCity).cloneNode(!0):loadJoinData(c,ddlCity,2);break;case"常用备注":if(ddlCommonNote.dataLoaded){if(ddlCommonNote.noData){alert("提示：没有添加常用备注，无法根据此条件查询！");break}c.appendChild(ddlCommonNote).cloneNode(!0)}else loadJoinData(c,ddlCommonNote,4);break;case"星标":case"支付状态":c.appendChild(ddlStar).cloneNode(!0);break;case"IP地址":case"核销码":case"完成凭证":case"用户ID":case"来源详情":"IP地址"==a||"用户ID"==a?(p=document.getElementById("spanInclude").cloneNode(!0),p.innerHTML="等于",c.appendChild(p)):"来源详情"==a&&(p=document.getElementById("spanInclude").cloneNode(!0),p.innerHTML="包含",c.appendChild(p)),c.appendChild(document.getElementById("spanEntry").cloneNode(!0)),c.getElementsByTagName("select")[0].style.display="none",c.getElementsByTagName("label")[0].style.display="none";break;case"提交答卷日期":case"填写所用时间":case"填写序号":case"分数":c.appendChild(document.getElementById("spanEntry").cloneNode(!0)),o=c.getElementsByTagName("select")[0],o.onchange=function(){var a=this.parentNode.getElementsByTagName("label")[0];a.style.display="3"==this.value?"":"none"},o.onchange();break;case"企业微信姓名":case"企业微信部门":b.style.width="478px",newele=document.createElement("span"),"企业微信部门"!=a?($(b).parent().parent().find(".qywx-chooselist-bm").eq(0).hide(),$(b).parent().parent().find(".qywx-chooselist-ry").eq(0).show(),newele.className="checkry",newele.setAttribute("peo",2),newele.setAttribute("type","user"),newele.innerHTML="选择人员"):($(b).parent().parent().find(".qywx-chooselist-bm").eq(0).show(),$(b).parent().parent().find(".qywx-chooselist-ry").eq(0).hide(),newele.className="checkbm",newele.innerHTML="选择部门",newele.setAttribute("type","department"),newele.setAttribute("peo",1)),c.appendChild(newele)}this.parentNode.parentNode.insertBefore(c,this.btnDelteQuery.parentNode),this.spanCondition=c,q=c.getElementsByTagName("input"),l=this.options[this.selectedIndex],r="提交答卷日期"==a||l&&"1"==l.getAttribute("isdate"),q[0]&&"checkbox"!=q[0].type&&(q[0].value="",q[0].checkType=a,q[0].onkeydown=doEnterQuery,r?(q[0].onclick=function(a){calendar.show(this,null,window.event||a)},q[0].onchange=q[0].onblur=null):(q[0].onchange=q[0].onblur=checkData,q[0].onclick=null),q[1]&&"checkbox"!=q[1].type&&(q[1].checkType=a,q[1].value="",q[1].onkeydown=doEnterQuery,r?(q[1].onclick=function(a){calendar.show(this,null,window.event||a)},q[1].onchange=q[0].onblur=null):(q[1].onchange=q[0].onblur=checkData,q[1].onclick=null))),window.isQywx&&"企业微信部门"!=a&&"企业微信姓名"!=a&&($(b).parent().parent().find(".qywx-chooselist-bm").html(""),$(b).parent().parent().find(".qywx-chooselist-ry").html("")),newele&&(newele.onclick=window.isQywxClient?wxcheckpeo:selPersonPart)}function loadJoinData(a,b,c){var e,f,g,h,i,j,d=loadData(c);if(!d)return alert("提示：没有添加常用备注，无法根据此条件查询！"),b.dataLoaded=!0,b.noData=!0,void 0;if(e=d.split("§"),!b.dataLoaded){for(f=0;f<e.length;f++)g=e[f],h=e[f],(3==c||4==c)&&(i=e[f].split("["),g=i[0],2==i.length&&(h=i[1].replace("]",""))),b.options.add(new Option(h,g));(1==c||3==c)&&(j=document.createElement("OPTGROUP"),j.label="---------------------",b.appendChild(j),b.options.add(new Option("合并多个选项的数据","")),b.onchange=function(){toCheck(this)}),b.dataLoaded=!0}a.appendChild(b).cloneNode(!0)}function doEnterQuery(a){return a=window.event||a,13==a.keyCode?(btnQueryClick(),a.returnValue=!1,!1):void 0}function BindQsChoiceData(a,b){var c,d,e,f,g,h;if(b)if(c=b.split("┋"),c.length>1){for(htCheckQs[a.value]="1",a.onchange(),d=new Object,e=0;e<c.length;e++)d[c[e]]="1";for(f=a.spanCondition.getElementsByTagName("input"),g=0;g<f.length;g++)h=f[g],d[h.value]&&(h.checked=!0)}else a.onchange(),a.spanCondition.getElementsByTagName("select")[0].value=b}function BindQsQuestionData(a,b){var c,d;a.onchange(),c=a.spanCondition.getElementsByTagName("input"),c[0].value=b[1]||"",c[1]&&b[3]&&(c[1].value=b[3]),b[2]||(b[2]="0"),d=a.spanCondition.getElementsByTagName("select")[0],d.value=b[2].split(";")[0],d.onchange&&d.onchange()}function isQuestion(a){return a.split("§").length>=2}function initQuery(){var a,b,c,d,e,f,g,h;if(ddlQuery.onchange=showCondition,ddlQuery.btnAddQuery=btnAddQuery,ddlQuery.btnDelteQuery=btnDelQ,btnAddQuery.onclick=addQuery,btnDelQ.onclick=function(){delQuery(ddlQuery.parentNode.parentNode,ddlQuery)},ddlQueries.push(ddlQuery),1==reportType&&(qCond||eCond)){if(a=!0,qCond)for(b=qCond.split("〒"),c=isQuestion(b[0]),c?(d=b[0].split("§"),ddlQuery.value=d[0],BindQsQuestionData(ddlQuery,d)):(d=b[0].split(","),ddlQuery.value=d[0],BindQsChoiceData(ddlQuery,d[1])),a=!1,e=1;e<b.length;e++)c=isQuestion(b[e]),c?(d=b[e].split("§"),addQuery(d[0],d)):(d=b[e].split(","),addQuery(d[0],d[1]));if(eCond)for(f=eCond.split("〒"),g=0,qCond||(bindECond(f[0],a),a=!1,g=1),e=g;e<f.length;e++)bindECond(f[e],a)}else{for(e=0;e<ddlQuery.options.length;e++)if(h=ddlQuery.options[e].text,isSample(h)||"企业微信部门"!=h){ddlQuery.selectedIndex=e;break}ddlQuery.onchange()}}function bindECond(a,b){var h,i,j,c=a.split("┋"),d="",e=c[1],f=c[2],g=c[3];switch(c[0]){case"1":d="提交答卷日期";break;case"3":d="填写所用时间";break;case"4":d="填写序号";break;case"5":d="分数";break;case"7":d="省份",e=f,f="",g="";break;case"8":d="来源",e=f,f="",g="";break;case"9":d="城市",e=f,f="",g="";break;case"10":d="IP地址";break;case"12":d="用户ID";break;case"11":d="核销码";break;case"13":d="来源详情";break;case"14":d="完成凭证";break;case"21":d="星标",1==window.isshop&&(d="支付状态"),e=f,f="",g="";break;case"16":if(d="企业微信姓名",c.length>2&&""!=c[2]&&(c.splice(0,2),userIds=c[0].split(","),toUserArr=userIds),e=f,f="",g="",!b)return addQuery(d,e,f,g),makeWxOrigin(d),void 0;makeWxOrigin(d);break;case"17":if(d="企业微信部门",e=f,f="",g="",partmentList=c[2]?partmentList=c[2].split(","):[],partmentList.length>0)for(h=0;h<partmentList.length;h++)partmentList[h]=parseInt(partmentList[h]);if(toDeptarr=partmentList,!b)return addQuery(d,e,f,g),makeWxOrigin(d),void 0;makeWxOrigin(d);break;case"31":d="常用备注",e=f,f="",g=""}b?(ddlQuery.value=d,ddlQuery.onchange(),i=ddlQuery.spanCondition.getElementsByTagName("input"),f&&(i[0]?i[0].value=f:(j=ddlQuery.spanCondition.getElementsByTagName("select"),null!=j&&j.length>0&&(ddlQuery.spanCondition.getElementsByTagName("select")[0].value=f))),g&&(i[1].value=g,i[1].parentNode.style.display=""),e&&showMulData(e,ddlQuery)):addQuery(d,e,f,g)}function makeWxOrigin(a){var c,d,b=ddlQueries.length-1;if("企业微信部门"==a){if(partmentList.length>0){for(c="",d=0;d<partmentList.length;d++)c+='<span class="qywxCspan"><ww-open-data type="departmentName" openid="'+partmentList[d]+'"></ww-open-data><i class="delDept"></i></span>';$(".qywx-chooselist-bm").eq(b).html(c),toDept=partmentList.join("|"),$(".delDept").click(function(){var b=$(this).parent(".qywxCspan").index();partmentList.splice(b,1),toDeptarr=partmentList,toDept=partmentList.join("|"),$(this).parent(".qywxCspan").remove()})}else $(".qywx-chooselist-bm").eq(b).html("");$(".qywx-chooselist-bm").eq(b).show()}if("企业微信姓名"==a){if(0==userIds.length)$(".qywx-chooselist-ry").eq(b).html("");else if(userIds.length>0&&userIds[0]){for(c="",d=0;d<userIds.length;d++)c+='<span class=\'qywxCspan\'><ww-open-data type="userName" openid="'+userIds[d]+"\"></ww-open-data><i class='delPeo'></i></span>";$(".qywx-chooselist-ry").eq(b).html(c),toUser=userIds.join("|"),$(".delPeo").click(function(){var b=$(this).parent(".qywxCspan").index();userIds.splice(b,1),toUserArr=userIds,toUser=userIds.join("|"),$(this).parent(".qywxCspan").remove()})}$(".qywx-chooselist-ry").eq(b).show()}}function delQuery(a,b){return 1==ddlQueries.length?(divQueryMsg.innerHTML="必须要保留一个查询条件",void 0):(ddlQuery.parentNode.parentNode.parentNode.removeChild(a),ddlQueries.remove(b),b==ddlQuery&&(ddlQuery=ddlQueries[0]),void 0)}function addQuery(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;return ddlQueries.length>=queryCount?(divQueryMsg.innerHTML="最多只允许"+queryCount+"个查询条件",2==queryCount&&(divQueryMsg.innerHTML+=window.isVip?"，<a href='/newwjx/manage/purchase.aspx' target='_blank'>购买企业版服务</a>允许4个查询条件":"，<a href='/register/upgradevip.aspx?upgradeReason=62' target='_blank'>升级并购买企业版</a>允许4个查询条件"),void 0):(divQueryMsg.innerHTML="",e=document.createElement("div"),e.className="condition-cont",f=ddlQuery.cloneNode(!0),f.onchange=showCondition,g=document.createElement("span"),e.appendChild(g),h=ddlQueries.length,i=ddlQueries[h-1].selectedIndex,j=0,i+1<ddlQuery.options.length?j=i+1:i-1>0&&(j=i-1),f.selectedIndex=j,a&&(f.value=a),g.appendChild(f),g.appendChild(document.createTextNode(" ")),k=document.createElement("span"),e.appendChild(k),l=btnAddQuery.cloneNode(!0),l.onclick=addQuery,f.btnAddQuery=l,f.spanCondition=null,m=btnDelQ.cloneNode(!0),m.onclick=function(){delQuery(e,f)},k.appendChild(m),f.btnDelteQuery=m,n=document.createElement("div"),n.className="qywx-chooselist-bm",o=document.createElement("div"),o.className="qywx-chooselist-ry",e.appendChild(n),e.appendChild(o),p=document.createElement("div"),p.style.clear="both",e.appendChild(p),ddlQuery.parentNode.parentNode.parentNode.appendChild(e),ddlQueries.push(f),parseInt(a)==a?b instanceof Array?BindQsQuestionData(f,b):BindQsChoiceData(f,b):(f.onchange(),q=f.spanCondition.getElementsByTagName("input"),q[0]&&(q[0].value=c||""),q[1]&&(q[1].value=d||"",d&&(q[1].parentNode.style.display="")),b&&showMulData(b,f)),void 0)}function showMulData(a,b){var d,e,f,g,h,i,c=a.split(",");if(c.length>1){for(htCheckQs[b.value]="1",b.onchange(),d=new Object,e=0;e<c.length;e++)d[c[e]]="1";for(f=b.spanCondition.getElementsByTagName("input"),g=0;g<f.length;g++)h=f[g],d[h.value]&&(h.checked=!0)}else i=b.spanCondition.getElementsByTagName("select")[0],i&&(i.value=a),i&&i.onchange&&i.onchange()}function isInt(a){return parseInt(a)==a}function isDate(a){var d,e,b=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/,c=a.match(b);return null==c?!1:(d=new Date(c[1],c[3]-1,c[4]),e=d.getFullYear()+c[2]+(d.getMonth()+1)+c[2]+d.getDate(),e==a)}function checkData(){var a=this.checkType;switch(a){case"省份":break;case"来源":break;case"城市":break;case"星标":case"支付状态":break;case"IP地址":case"核销码":case"完成凭证":case"用户ID":case"来源详情":break;case"提交答卷日期":isDate(this.value)||(this.value="",divQueryMsg.innerHTML="必须为日期(如2010-1-1)");break;case"填写序号":break;case"填写所用时间":case"分数":isInt(this.value)||(this.value="",divQueryMsg.innerHTML="必须为整数")}}function getQueryCond(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,a="",b="";for(queryName="",c=0,d=0,e=new Object,f=0;f<ddlQueries.length;f++)if(g=ddlQueries[f].value,!e[g])if(e[g]="1",parseInt(g)==g){if(c>0&&(a+="〒"),h="",htQuestion[g])i=ddlQueries[f].spanCondition.getElementsByTagName("input"),j=i[0],k=ddlQueries[f].spanCondition.getElementsByTagName("select")[0],l="",j.value&&(l=g+"§"+j.value+"§"+k.value),"2"==htQuestion[g]&&(l+=";1"),"2"==htQuestion[g]&&"3"==k.value&&(i[1].value?l+="§"+i[1].value:l=""),a+=l;else{if(htCheckQs[g])for(m=ddlQueries[f].spanCondition.getElementsByTagName("input"),n=0,o=0;o<m.length;o++)p=m[o],p.checked&&(n>0&&(h+="┋"),h+=p.value,n++);else q=ddlQueries[f].spanCondition.getElementsByTagName("select")[0],h=q.value,queryName+=q.options[q.selectedIndex].text;a+=g+","+h}c++}else{if(d>0&&(b+="〒"),r="",htCheckQs[g])for(m=ddlQueries[f].spanCondition.getElementsByTagName("input"),n=0,o=0;o<m.length;o++)p=m[o],p.checked&&(n>0&&(r+=","),r+=p.value,n++);else q=ddlQueries[f].spanCondition.getElementsByTagName("select")[0],q&&(s=q.selectedIndex,r=q.value);switch(t=ddlQueries[f].spanCondition.getElementsByTagName("input"),u=t[0],v=t[1],g){case"省份":b+="7┋0┋"+r,queryName+=r;break;case"常用备注":q&&(b+="31┋0┋"+r,queryName+=r);break;case"来源":b+="8┋0┋"+r,queryName+=r;break;case"城市":b+="9┋0┋"+r,queryName+=r;break;case"IP地址":b+="10┋0┋"+u.value;break;case"核销码":b+="11┋0┋"+u.value;break;case"完成凭证":b+="14┋0┋"+u.value;break;case"用户ID":b+="12┋0┋"+u.value;break;case"星标":case"支付状态":b+="21┋0┋"+ddlStar.value;break;case"来源详情":b+="13┋0┋"+u.value;break;case"提交答卷日期":b+="1┋"+s+"┋"+u.value+"┋"+v.value;break;case"填写所用时间":b+="3┋"+s+"┋"+u.value+"┋"+v.value;break;case"填写序号":b+="4┋"+s+"┋"+u.value+"┋"+v.value;break;case"分数":b+="5┋"+s+"┋"+u.value+"┋"+v.value;break;case"企业微信姓名":b+="16┋0┋"+toUser.split("|").join(",");break;case"企业微信部门":b+="17┋0┋"+toDept.split("|").join(",")}d++}return a=encodeURIComponent(a),b=encodeURIComponent(b),[a,b]}var newele,queryName,htCheckQs=new Object,htQuestion=new Object;ddlSaveQuery&&(ddlSaveQuery.onchange=function(){this.value&&(window.location=this.value),btnDelQuery.style.display=this.value?"":"none",btnShareReport.style.display=this.value?"":"none"}),btnDelQuery&&(btnDelQuery.style.display=reportid&&reportid-0>0?"":"none",btnDelQuery.onclick=function(){var a="/wjx/report/deletereport.aspx?activity="+activityId+"&reportid="+reportid+"&returnurl="+encodeURIComponent(window.location.href);lconfirm("此操作无法恢复，确认删除吗？",function(){PDF_launch(a,400,100)})}),btnShareReport&&(btnShareReport.style.display=ddlSaveQuery.value?"":"none",btnShareReport.onclick=function(){return isVip?(PDF_launch("/wjx/ActivityStat/shareviewsummary.aspx?activity="+activityId+"&reportid"+reportid,720,520),void 0):(alert("很抱歉，此功能只对企业版用户开放"),void 0)}),queryName="",document.onclick=function(){window.calendar&&calendar.hide()},initQuery(),setTimeout(function(){window.needHideCond&&window.currentJoinTimes&&2e5>currentJoinTimes&&(btnAddQuery.style.display="")},1e3);